<!doctype>
<html>
<head>
    <meta charset="UTF-8">
    <script src="../Script/jquery-1.10.2.min.js"></script>
    <script src="../config/config.js"></script>
    <script src="../Script/plugins/bootstrap/js/bootstrap.min.js"></script>
    <script src="../Script/plugins/layui/layui.all.js"></script>
    <script src="../Script/plugins/bootstarp-table/bootstrap-table.js"></script>
    <script src="../Script/plugins/bootstarp-table/locale/bootstrap-table-zh-CN.js"></script>
    <link rel="stylesheet" type="text/css" href="../Script/plugins/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="../Script/plugins/bootstarp-table/bootstrap-table.min.css">
    <link rel="stylesheet" type="text/css" href="../css/common.css">
    <link rel="stylesheet" type="text/css" href="../css/button.css">
    <style>
        html,body{
            margin: 0px;
            padding: 0px;
            width: 100%;
            height:100%;
            font-family: "Microsoft YaHei";
            font-size: 16px;
        }
        .mainContent{
            width: 100%;
            height: 100%;
            padding: 15px;
        }
        .head{
            margin-bottom: 10px;
        }
        .toolBar{
            float: left;
            line-height: 34px;
        }
        .searchContent{
            width: 200px;
            float: right;
        }
        .table{
            width: 100%;
            font-size: 14px;
        }
        .fixed-table-header th{
            font-size: 14px;
            border: none;
            background-color: #eff6fd;
        }
        .fixed-table-body{
            font-size: 12px;
        }
        .fixed-table-body td{
            color: #888;
        }
    </style>
</head>
<body>
<div class="mainContent">
    <div class="head">
    <div class="toolBar">
        <a class="normaBtn addBtn">新增</a>
    </div>
    <div class="searchContent"><input class="form-control" placeholder="请输入用户名"></div>
        <div style="clear:both;"></div>
    </div>
    <table class="table"></table>
</div>
</body>
<script>
    var layer = layui.layer;
    $(function(){
        bindEvent();
        initTable();
    });
    function bindEvent(){
        $(".addBtn").bind("click",function(){
            layer.open({
                type:2,
                content:'user_add.html',
                title:'新增用户',
                skin:'blue-skin',
                closeBtn:1,
                shade:0,
                area:['1000px','440px'],
                yes:function(layero,index){
                },
                end:function(){

                }
            })

        })

    };

    function refreshTable(){
        $(".table").bootstrapTable('refresh')
    }

    function initTable(){
        $(".table").bootstrapTable({
            url :  contextPath+'/secUser/findAllByPage', // 请求后台的URL（*）
            striped : true, // 是否显示行间隔色
            cache : false, // 是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
            pagination : true, // 是否显示分页（*）
            height :$(".mainContent").height()-$(".head").height(),
            sidePagination : "server", // 服务端请求
            sortable : true, // 是否启用排序
            sortOrder : "asc", // 排序方式
            queryParams : function(params) {
                    return {
                        userName:$(".searchContent input").val(),
                        pageNum:params.offset,
                        pageSize:params.limit,
                    }
            },// 传递参数（*）
            uniqueId:'userId',// 每一行的唯一标识，一般为主键列
            pageNumber : 1, // 初始化加载第一页，默认第一页
            pageSize : 20, // 每页的记录行数（*）
            pageList : [ 10, 20, 40, 100 ], // 可供选择的每页的行数（*）
            search : false, // 是否显示表格搜索，此搜索是客户端搜索，不会进服务端，所以，个人感觉意义不大
            strictSearch : false,
            showColumns : false, // 是否显示所有的列
            showRefresh : false, // 是否显示刷新按钮
            minimumCountColumns : 2, // 最少允许的列数
            clickToSelect : true, // 是否启用点击选中行
            showToggle : false, // 是否显示详细视图和列表视图的切换按钮
            cardView : false, // 是否显示详细视图
            detailView : false, // 是否显示父子表
            responseHandler:function(res){
                return {
                    rows:res.data.content,
                    total:res.data.totalElements
                }
            },
            onLoadSuccess:function(){

            },
            columns : [
            {
                field : 'userLoginName',
                title : '用户名',
                width : 30,
                align : 'center'
            },
            {
                field : 'userIsSuperAdmin',
                title : '是否是超级管理员',
                width : 100,
                align : 'center',
                formatter:function(v){
                    if(v==1){
                        return "超级管理员"
                    }
                    return '普通用户'
                }
            },
            {
                field : 'userCreateTime',
                title : '用户创建时间',
                width : 100,
                align : 'center',
            },
            {
                title : '操作',
                width : 100,
                align : 'center',
                formatter : function(value, row, index) {
                    var btnStr = '<a onclick="editUser(\''+row.userId+'\')" class="normaBtn editBtn">编辑</a>';
                    if(row.userUsesMark){
                        btnStr+='<a onclick="updateUsesMark(\''+row.userId+'\',0)"  class="normaBtn disabledBtn">禁用</a>'
                    }else{
                        btnStr+='<a onclick="updateUsesMark(\''+row.userId+'\',1)" class="normaBtn startBtn">启用</a>'
                    }
                    btnStr+='<a onclick="deleteUser(\''+row.userId+'\')" class="normaBtn deleteBtn">删除</a>'
                    return btnStr;
                }
            } ]
    })
    }

    function editUser(userId){
            layer.open({
                type:2,
                content:'user_add.html',
                title:'编辑用户',
                skin:'blue-skin',
                area:['1000px','440px'],
                closeBtn:1,
                shade:0,
                success:function(layero, index){
                    var body = layer.getChildFrame('body', index);
                    var iframeWin = window[layero.find('iframe')[0]['name']]; //得到iframe页的窗口对象，执行iframe页的方法：
                    iframeWin.setData(userId);
                },
                end:function(){

                }
            })
    }

    function updateUsesMark(userId,type){
        $.ajax({
            url: contextPath + "/secUser/updateUsesMark",
            data: {userId: userId,usesMark:type},
            type: 'post',
            success: function (res) {
                if (res.resultInfo.code == 0) {
                    if(type==1){
                        layer.msg("启用成功");
                    }else{
                        layer.msg("禁用成功")
                    }
                    var row=$(".table").bootstrapTable('getRowByUniqueId',userId);
                    row.userUsesMark=type;
                    $(".table").bootstrapTable('updateByUniqueId',{userId:userId,row:row});
                }
            }
        });
    }
    function deleteUser(userId){
        layer.confirm("确定删除该用户",{
            btn:['确定','取消'],
            skin:'blue-skin',
            shade:0,
        },function(){
            $.ajax({
                url: contextPath + "/secUser/deleteUser",
                data: {userId: userId},
                success: function (res) {
                    if (res.resultInfo.code == 0) {
                        layer.msg("删除用户成功");
                        $(".table").bootstrapTable('removeByUniqueId',userId);
                    }else{
                        layer.msg("删除用户失败")
                    }
                }
            });
        });

    }

</script>
</html>